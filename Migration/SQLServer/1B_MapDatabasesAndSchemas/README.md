
# **Module 1B_MapDatabasesAndSchemas** 

Use module **1B_MapDatabasesAndSchemas** to replace schema names in DDL scripts generated by module **1A_ExtractCodeDDLs**. This may be required when consolidating multiple source databases into a single Azure Synapse dedicated SQL Pool to avoid conflicts in objects naming.

The PowerShell script makes the following changes in DDL scripts:

- Adds default schema name if schema name is missing in object references
- Replaces schema names according to schema mapping.

You need to run **MapDatabasesAndSchemas.ps1** script which will prompt you for the following configuration information:

1. **cs_dirs.csv** - this CSV file specifies the list of directories where source DDL scripts are located.
2. **schemas.csv** - this CSV file defines source-to-target schema mapping.
3. **Do you want to use 3-part names?** If YES then the script will generate 3-part names for all object references. This may be useful for cross-database queries (* expected to be available in Azure Synapse Gen3).
4. **Do you want to add missing schemas?** If YES then default schema name will be added to object references where schema name is omitted. This may be useful when migrating multiple databases and schemas to make object references more explicit and readable.

The definition and sample values for each column in **cs_dirs.csv** file are described in below table:

| Column             | Description                                                  | Sample Values                                                |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Active             | 1 – Use record,  0 – Skip record.                            | 0 or 1                                                       |
| SourceDatabaseName | The name of source database                                  | AdventureWorks2019                                           |
| SourceDirectory    | The directory where source DDL scripts are located           | C:\temp\1A_ExtractCodeDDLs<br />\AdventureWorks2019\Views    |
| TargetDirectory    | The directory where converted DDL scripts will be stored     | C:\temp\1B_MapDatabasesAndSchemas\<br />\AdventureWorks2019\Views |
| DefaultSchema      | Default schema name which will be assume if schema name is omitted in object reference | dbo                                                          |
| ObjectType         | The type of objects for the source directory                 | Function<br />SP<br />View                                   |

The definition and sample values for each column in **schemas.csv** is described in below table:

| Column         | Description                                              | Sample Values      |
| -------------- | -------------------------------------------------------- | ------------------ |
| SourceDatabase | 1 – Use record,  0 – Skip record.                        | AdventureWorks2019 |
| SourceSchema   | The name of source database                              | dbo                |
| TargetDatabase | The directory where source DDL scripts are located       | EDW                |
| TargetSchema   | The directory where converted DDL scripts will be stored | aw                 |

Sample script output is depicted below.

![](..\images\M1B_ScriptOutput.JPG)

Extracted DDL scripts will be stored under Output folder and structured by respective database name and object type (View, Functions, Stored Procedures, Triggers).

![](..\images\M1B_OutputFolder.JPG)

![](..\images\M1B_SampleFolder.JPG)



#### **Important notes**

- Configuration files are expected in the same folder where the script is located.
- As DDL scripts are processed using regular expressions it may take considerable time to process large scripts.
- If output folder is not empty existing files will be overwritten in case of file name match.


